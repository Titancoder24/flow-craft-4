<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowCraft AI - App Flow Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .loading-dots::after {
            content: '';
            animation: dots 2s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <span class="text-white text-sm font-bold">FC</span>
                </div>
                <span class="text-xl font-bold gradient-text">FlowCraft AI</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-24 min-h-screen">
        <!-- Step 1: Initial Prompt -->
        <div id="promptStep" class="max-w-4xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-5xl md:text-6xl font-bold mb-6">
                    Design complete <span class="gradient-text">app flows</span>
                </h1>
                <p class="text-xl text-gray-300 mb-8">
                    Generate multi-screen app designs with user flows, powered by Grok
                </p>
            </div>

            <div class="glass rounded-2xl p-8">
                <h2 class="text-2xl font-semibold mb-6">Describe your app idea</h2>
                
                <textarea 
                    id="appIdea"
                    placeholder="e.g., A fitness tracking app for runners with workout plans, progress tracking, social features, and achievement system"
                    class="w-full bg-gray-800/50 rounded-xl p-4 text-white placeholder-gray-400 border border-gray-600 focus:border-blue-500 focus:outline-none resize-none h-32 mb-6"
                ></textarea>

                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">App Type</label>
                        <select id="appType" class="w-full bg-gray-800 rounded-lg px-4 py-3 border border-gray-600 focus:border-blue-500">
                            <option>Mobile App</option>
                            <option>Web App</option>
                            <option>SaaS Dashboard</option>
                            <option>E-commerce</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Style</label>
                        <select id="designStyle" class="w-full bg-gray-800 rounded-lg px-4 py-3 border border-gray-600 focus:border-blue-500">
                            <option>Modern & Minimal</option>
                            <option>Glassmorphism</option>
                            <option>Dark Theme</option>
                            <option>Colorful & Vibrant</option>
                        </select>
                    </div>
                </div>

                <button 
                    id="generateBtn"
                    class="w-full bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl py-4 font-semibold text-lg hover:opacity-90 transition-opacity"
                >
                    Generate App Flow with Grok ⚡
                </button>
            </div>
        </div>

        <!-- Step 2: Loading -->
        <div id="loadingStep" class="hidden max-w-4xl mx-auto px-6 py-12">
            <div class="glass rounded-2xl p-12 text-center">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <div class="w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                </div>
                <h2 class="text-3xl font-bold mb-4">Grok is crafting your app<span class="loading-dots"></span></h2>
                <p class="text-gray-300 mb-6">Analyzing your idea and creating beautiful screens</p>
                <div class="max-w-md mx-auto bg-gray-800 rounded-full h-2">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Step 3: Results -->
        <div id="resultsStep" class="hidden max-w-7xl mx-auto px-6 py-12">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold gradient-text">Your Generated App Flow</h2>
                <div class="flex space-x-3">
                    <button id="newFlowBtn" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                        🔄 New Flow
                    </button>
                    <button id="exportBtn" class="px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700 transition-colors">
                        📱 Export All
                    </button>
                </div>
            </div>

            <!-- Generated Screens Grid -->
            <div id="screensGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Screens will be populated here -->
            </div>

            <!-- Flow Description -->
            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-semibold mb-4">User Flow Description</h3>
                <div id="flowDescription" class="text-gray-300">
                    <!-- Flow description will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Your exact API configuration
        const API_KEY = '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';
        const API_URL = 'https://openrouter.ai/api/v1/chat/completions';
        const MODEL = 'x-ai/grok-code-fast-1';

        // DOM Elements
        const promptStep = document.getElementById('promptStep');
        const loadingStep = document.getElementById('loadingStep');
        const resultsStep = document.getElementById('resultsStep');
        const appIdea = document.getElementById('appIdea');
        const appType = document.getElementById('appType');
        const designStyle = document.getElementById('designStyle');
        const generateBtn = document.getElementById('generateBtn');
        const progressBar = document.getElementById('progressBar');
        const screensGrid = document.getElementById('screensGrid');
        const flowDescription = document.getElementById('flowDescription');

        // Main generate function
        generateBtn.addEventListener('click', async () => {
            const idea = appIdea.value.trim();
            if (!idea) {
                alert('Please describe your app idea first!');
                return;
            }

            console.log('Starting generation with Grok...');
            showLoading();

            try {
                await generateAppFlow(idea, appType.value, designStyle.value);
            } catch (error) {
                console.error('Generation failed:', error);
                alert('Failed to generate app flow. Check console for details.');
                hideLoading();
            }
        });

        async function generateAppFlow(idea, type, style) {
            console.log('Calling Grok API...');
            updateProgress(10);

            // Step 1: Generate app flow structure
            const flowPrompt = `You are an expert app designer. Create a complete app flow for this idea:

APP IDEA: ${idea}
TYPE: ${type}
STYLE: ${style}

Generate a JSON response with this structure:
{
  "appName": "Creative app name",
  "description": "Brief app description",
  "screens": [
    {
      "name": "Screen name",
      "type": "onboarding/main/detail/etc",
      "description": "What this screen does",
      "elements": ["Button", "Header", "Card", "etc"]
    }
  ]
}

Create 4-6 key screens that make sense for this app. Make it realistic and useful.`;

            const flowResponse = await callGrokAPI(flowPrompt);
            updateProgress(30);

            let flowData;
            try {
                // Clean the response and parse JSON
                const cleanResponse = flowResponse.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                flowData = JSON.parse(cleanResponse);
                console.log('Flow data:', flowData);
            } catch (e) {
                console.error('JSON parse error:', e);
                throw new Error('Failed to parse flow data');
            }

            updateProgress(50);

            // Step 2: Generate UI for each screen
            const screenPromises = flowData.screens.map(async (screen, index) => {
                console.log(`Generating UI for screen: ${screen.name}`);
                
                const uiPrompt = `Create a beautiful ${type} screen UI with ${style} design.

SCREEN: ${screen.name}
DESCRIPTION: ${screen.description}
ELEMENTS: ${screen.elements.join(', ')}

Generate clean HTML with Tailwind CSS. Make it modern and beautiful.
Include realistic content, proper spacing, and ${style} styling.

Return ONLY the HTML code, no explanations:`;

                const screenHTML = await callGrokAPI(uiPrompt);
                updateProgress(50 + ((index + 1) / flowData.screens.length) * 40);

                return {
                    ...screen,
                    html: screenHTML.replace(/```html\n?/g, '').replace(/```\n?/g, '').trim()
                };
            });

            const generatedScreens = await Promise.all(screenPromises);
            updateProgress(100);

            // Show results
            showResults(flowData, generatedScreens);
        }

        async function callGrokAPI(prompt) {
            console.log('Making API call to Grok...');
            console.log('API Key:', API_KEY.substring(0, 10) + '...');
            console.log('Model:', MODEL);
            console.log('Prompt length:', prompt.length);
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'FlowCraft AI'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                console.log('API Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log('API Response data:', data);
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    console.error('Invalid API response structure:', data);
                    throw new Error('Invalid API response structure');
                }
                
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }

        function showLoading() {
            promptStep.classList.add('hidden');
            loadingStep.classList.remove('hidden');
            resultsStep.classList.add('hidden');
            updateProgress(0);
        }

        function hideLoading() {
            loadingStep.classList.add('hidden');
        }

        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
        }

        function showResults(flowData, screens) {
            console.log('Showing results...');
            hideLoading();
            resultsStep.classList.remove('hidden');

            // Clear previous results
            screensGrid.innerHTML = '';

            // Create screen cards
            screens.forEach((screen, index) => {
                const screenCard = document.createElement('div');
                screenCard.className = 'glass rounded-xl overflow-hidden hover:scale-105 transition-transform';
                
                screenCard.innerHTML = `
                    <div class="bg-white rounded-t-xl">
                        <iframe 
                            class="w-full h-64 bg-white" 
                            srcdoc="${screen.html.replace(/"/g, '&quot;')}"
                            style="pointer-events: none;"
                        ></iframe>
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-semibold mb-2">${screen.name}</h3>
                        <p class="text-gray-300 text-sm mb-3">${screen.description}</p>
                        <div class="flex flex-wrap gap-1 mb-3">
                            ${screen.elements.map(el => 
                                `<span class="px-2 py-1 bg-blue-600/20 rounded text-xs">${el}</span>`
                            ).join('')}
                        </div>
                        <button 
                            onclick="viewFullScreen(${index})" 
                            class="w-full bg-gray-700 hover:bg-gray-600 rounded-lg py-2 text-sm transition-colors"
                        >
                            👁️ View Full Screen
                        </button>
                    </div>
                `;
                
                screensGrid.appendChild(screenCard);
            });

            // Update flow description
            flowDescription.innerHTML = `
                <h4 class="font-semibold text-lg mb-2">${flowData.appName}</h4>
                <p class="mb-4">${flowData.description}</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-medium mb-2">Screen Flow:</h5>
                        <ol class="space-y-1 text-sm">
                            ${screens.map((screen, i) => 
                                `<li>${i + 1}. ${screen.name}</li>`
                            ).join('')}
                        </ol>
                    </div>
                    <div>
                        <h5 class="font-medium mb-2">Generated with:</h5>
                        <ul class="space-y-1 text-sm">
                            <li>• Grok Code Fast 1 Model</li>
                            <li>• ${screens.length} Custom Screens</li>
                            <li>• Tailwind CSS Styling</li>
                            <li>• Production-Ready Code</li>
                        </ul>
                    </div>
                </div>
            `;

            // Store screens globally for full screen view
            window.generatedScreens = screens;
        }

        // View full screen function
        window.viewFullScreen = function(index) {
            const screen = window.generatedScreens[index];
            const newWindow = window.open('', '_blank', 'width=400,height=800');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${screen.name} - Full Screen</title>
                    <script src="https://cdn.tailwindcss.com"></script>
                </head>
                <body>
                    ${screen.html}
                </body>
                </html>
            `);
        };

        // New flow button
        document.getElementById('newFlowBtn')?.addEventListener('click', () => {
            promptStep.classList.remove('hidden');
            resultsStep.classList.add('hidden');
            appIdea.value = '';
        });

        // Export button
        document.getElementById('exportBtn')?.addEventListener('click', () => {
            if (window.generatedScreens) {
                let exportHTML = '<!DOCTYPE html><html><head><title>Generated App Flow</title><script src="https://cdn.tailwindcss.com"></script></head><body>';
                
                window.generatedScreens.forEach((screen, i) => {
                    exportHTML += `<div style="page-break-after: always;"><h2>Screen ${i + 1}: ${screen.name}</h2>${screen.html}</div>`;
                });
                
                exportHTML += '</body></html>';
                
                const blob = new Blob([exportHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'app-flow.html';
                a.click();
                URL.revokeObjectURL(url);
            }
        });

        console.log('FlowCraft AI initialized with Grok Code Fast 1');
    </script>
</body>
</html>